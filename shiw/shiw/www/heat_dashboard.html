{% extends "templates/web.html" %}

{% block title %}{{ _("Heat Dashboard") }}{% endblock %}

{% block page_content %}
<div class="heat-dashboard">
    <!-- Header -->
    <div class="dashboard-header">
        <h1 class="dashboard-title">{{ _("Heat Dashboard") }}</h1>
        <p class="dashboard-subtitle">{{ _("Monitor Total Charge Mix, Liquid Balance, and Burning Loss") }}</p>
    </div>

    <!-- Date Filter Form -->
    <div class="date-filter-section">
        <form method="GET" class="date-filter-form">
            <div class="form-row">
                <div class="form-group">
                    <label for="from_date">{{ _("From Date") }}</label>
                    <input type="date" id="from_date" name="from_date" value="{{ report_data.from_date }}"
                        class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="to_date">{{ _("To Date") }}</label>
                    <input type="date" id="to_date" name="to_date" value="{{ report_data.to_date }}"
                        class="form-control" required>
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-primary">
                        <i class="fa fa-search"></i> {{ _("Update") }}
                    </button>
                </div>
            </div>
        </form>
    </div>

    <!-- Error Display -->
    {% if report_data.error %}
    <div class="alert alert-danger">
        <i class="fa fa-exclamation-triangle"></i>
        {{ _("Error loading data:") }} {{ report_data.error }}
    </div>
    {% endif %}

    <!-- Number Cards -->
    <div class="number-cards-container">
        {% if report_data.report_summary %}
        {% for card in report_data.report_summary %}
        <div class="number-card card-{{ card.indicator.lower() }}">
            <div class="card-content">
                <div class="card-value">
                    {% if card.datatype == "Float" %}
                    {{ "{:,.3f}".format(card.value or 0) }}
                    {% else %}
                    {{ "{:,.0f}".format(card.value or 0) }}
                    {% endif %}
                </div>
                <div class="card-label">{{ card.label }}</div>
            </div>
            <div class="card-indicator {{ card.indicator.lower() }}"></div>
        </div>
        {% endfor %}
        {% else %}
        <div class="no-data-message">
            <i class="fa fa-info-circle"></i>
            {{ _("No data available for the selected date range") }}
        </div>
        {% endif %}
    </div>

    <!-- Data Table -->
    {% if report_data.data %}
    <div class="data-table-section">
        <h3>{{ _("Detailed Data") }}</h3>
        <div class="table-responsive">
            <table class="table table-bordered table-striped">
                <thead>
                    <tr>
                        {% for column in report_data.columns %}
                        <th>{{ column.label }}</th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                    {% for row in report_data.data %}
                    <tr>
                        {% for column in report_data.columns %}
                        <td>
                            {% if column.fieldtype == "Float" %}
                            {{ "{:,.3f}".format(row[column.fieldname] or 0) }}
                            {% else %}
                            {{ row[column.fieldname] or "" }}
                            {% endif %}
                        </td>
                        {% endfor %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}
</div>

<style>
    .heat-dashboard {
        padding: 20px;
        max-width: 1200px;
        margin: 0 auto;
    }

    .dashboard-header {
        text-align: center;
        margin-bottom: 30px;
    }

    .dashboard-title {
        color: #2c3e50;
        font-size: 2.5rem;
        margin-bottom: 10px;
    }

    .dashboard-subtitle {
        color: #7f8c8d;
        font-size: 1.1rem;
    }

    .date-filter-section {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 30px;
    }

    .date-filter-form {
        display: flex;
        align-items: end;
        gap: 20px;
        flex-wrap: wrap;
    }

    .form-group {
        display: flex;
        flex-direction: column;
    }

    .form-group label {
        font-weight: 600;
        margin-bottom: 5px;
        color: #2c3e50;
    }

    .form-control {
        padding: 8px 12px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
    }

    .btn-primary {
        background: #007bff;
        border: none;
        padding: 10px 20px;
        color: white;
        border-radius: 4px;
        cursor: pointer;
        font-weight: 600;
    }

    .btn-primary:hover {
        background: #0056b3;
    }

    .number-cards-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .number-card {
        background: white;
        border-radius: 10px;
        padding: 25px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        position: relative;
        overflow: hidden;
        transition: transform 0.2s ease;
    }

    .number-card:hover {
        transform: translateY(-2px);
    }

    .card-content {
        text-align: center;
    }

    .card-value {
        font-size: 2.5rem;
        font-weight: bold;
        color: #2c3e50;
        margin-bottom: 10px;
    }

    .card-label {
        font-size: 1.1rem;
        color: #7f8c8d;
        font-weight: 500;
    }

    .card-indicator {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
    }

    .card-indicator.blue {
        background: linear-gradient(90deg, #3498db, #2980b9);
    }

    .card-indicator.black {
        background: linear-gradient(90deg, #34495e, #2c3e50);
    }

    .card-indicator.green {
        background: linear-gradient(90deg, #27ae60, #229954);
    }

    .no-data-message {
        text-align: center;
        padding: 40px;
        color: #7f8c8d;
        font-size: 1.1rem;
        grid-column: 1 / -1;
    }

    .data-table-section {
        background: white;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .data-table-section h3 {
        color: #2c3e50;
        margin-bottom: 20px;
    }

    .table {
        width: 100%;
        border-collapse: collapse;
    }

    .table th {
        background: #f8f9fa;
        padding: 12px;
        text-align: left;
        font-weight: 600;
        color: #2c3e50;
        border: 1px solid #dee2e6;
    }

    .table td {
        padding: 12px;
        border: 1px solid #dee2e6;
    }

    .table-striped tbody tr:nth-child(odd) {
        background: #f8f9fa;
    }

    .alert {
        padding: 15px;
        border-radius: 4px;
        margin-bottom: 20px;
    }

    .alert-danger {
        background: #f8d7da;
        border: 1px solid #f5c6cb;
        color: #721c24;
    }

    @media (max-width: 768px) {
        .date-filter-form {
            flex-direction: column;
            align-items: stretch;
        }

        .number-cards-container {
            grid-template-columns: 1fr;
        }

        .dashboard-title {
            font-size: 2rem;
        }
    }
</style>

<script>
    // Auto-submit form when dates change
    document.addEventListener('DOMContentLoaded', function () {
        const fromDate = document.getElementById('from_date');
        const toDate = document.getElementById('to_date');
        const form = document.querySelector('.date-filter-form');

        // Auto-submit when both dates are selected
        function checkAndSubmit() {
            if (fromDate.value && toDate.value) {
                form.submit();
            }
        }

        fromDate.addEventListener('change', checkAndSubmit);
        toDate.addEventListener('change', checkAndSubmit);
    });
</script>
{% endblock %}


